<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rsi">
<title>A whirlwind tour of rsi • rsi</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Libre_Franklin-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A whirlwind tour of rsi">
<meta property="og:description" content="rsi">
<meta property="og:image" content="https://permian-global-research.github.io/rsi/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rsi</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/rsi.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Downloading-data-from-STAC-APIs-using-rsi.html">Downloading data from STAC APIs using rsi</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Permian-Global-Research/rsi/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>A whirlwind tour of rsi</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Permian-Global-Research/rsi/blob/HEAD/vignettes/rsi.Rmd" class="external-link"><code>vignettes/rsi.Rmd</code></a></small>
      <div class="d-none name"><code>rsi.Rmd</code></div>
    </div>

    
    
<p>The rsi package aims to help you download data from STAC APIs, to
compute spectral indices from data, and to handle a handful of other
spatial data wrangling tasks. This vignette walks through the main
features of the package. Let’s start off by loading the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Permian-Global-Research/rsi" class="external-link">rsi</a></span><span class="op">)</span></span></code></pre></div>
<p>In order to download data from a STAC API, we’re going to need to
specify both a spatial and temporal area of interest. To define our
spatial area of interest, we’ll first mock up a small bounding box in
northern Massachusetts (in a planar CRS appropriate for the region):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">200000</span>, ymin <span class="op">=</span> <span class="fl">900000</span>, xmax <span class="op">=</span> <span class="fl">200100</span>, ymax <span class="op">=</span> <span class="fl">900100</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fl">26986</span></span>
<span><span class="op">)</span></span>
<span><span class="va">our_aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">our_aoi</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">our_aoi</span><span class="op">)</span></span>
<span><span class="co">#&gt; 10000 [m^2]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">our_aoi</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="rsi_files/figure-html/unnamed-chunk-2-1.png" width="768"></p>
<p>This is the area we’re going to download and process data for.</p>
<p>Out of the box, rsi includes a number of functions to make it easy to
download the most popular data sets from public STAC APIs. For instance,
the <code><a href="../reference/get_stac_data.html">get_landsat_imagery()</a></code> has a number of default arguments
for downloading Landsat 8 and 9 imagery from Microsoft’s Planetary
Computer. We’ll pass our spatial area of interest along with a timeframe
to this function, in order to get a cloud-masked composite image of all
Landsat acquisitions for our spatiotemporal window. Let’s grab all the
imagery from September 2023:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_imagery</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_stac_data.html">get_landsat_imagery</a></span><span class="op">(</span></span>
<span>  <span class="va">our_aoi</span>,</span>
<span>  <span class="st">"2023-09-01"</span>,</span>
<span>  <span class="st">"2023-09-30"</span>,</span>
<span>  output_filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">our_imagery</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpMWQXIv/file2783626b7201.tif"</span></span></code></pre></div>
<p>If we wanted to, we could use <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code> here to
specify a parallelization methodology to speed up downloads by using
multiple threads. We could also use <code><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">progressr::handlers()</a></code>
to get a progress bar to report our download status.</p>
<p>By default, <code><a href="../reference/get_stac_data.html">get_landsat_imagery()</a></code> will download a
composite of all bands available in Landsat 8 and 9 imagery for our
timeframe:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">our_imagery</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="rsi_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<p>Notice that this composite has been cloud-masked (using the QA pixel
band) and rescaled (using the scale and offset specified in metadata
provided by the STAC endpoint) automatically. You can control these
behaviors via function arguments.</p>
<p>We’re also able to use rsi to download other data sets – for
instance, we could also grab a DEM for this area from Planetary
Computer, using the <code><a href="../reference/get_stac_data.html">get_dem()</a></code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_stac_data.html">get_dem</a></span><span class="op">(</span><span class="va">our_aoi</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">our_dem</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="rsi_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>Under the hood, both of these functions (and their friends,
<code><a href="../reference/get_stac_data.html">get_sentinel2_imagery()</a></code> and
<code><a href="../reference/get_stac_data.html">get_sentinel1_imagery()</a></code>) are powered by a lower-level
<code><a href="../reference/get_stac_data.html">get_stac_data()</a></code> function, which should theoretically work
with any imagery provided by any STAC API, anywhere. These functions
simply provide user-friendly defaults to make it faster to get the data
you care about.</p>
<p>In addition to these STAC-focused data-downloading functions, rsi
also has an interface to the <a href="https://github.com/awesome-spectral-indices/awesome-spectral-indices" class="external-link">Awesome
Spectral Indices</a> project via the <code><a href="../reference/spectral_indices.html">spectral_indices()</a></code>
function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spectral_indices.html">spectral_indices</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">#&gt;   application_domain bands     contributor    date_of_addition formula long_name</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> vegetation         <span style="color: #949494;">&lt;chr [2]&gt;</span> https://githu… 2021-11-17       (N - 0… Aerosol …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> vegetation         <span style="color: #949494;">&lt;chr [2]&gt;</span> https://githu… 2021-11-17       (N - 0… Aerosol …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> water              <span style="color: #949494;">&lt;chr [6]&gt;</span> https://githu… 2022-09-22       (B + G… Augmente…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> vegetation         <span style="color: #949494;">&lt;chr [2]&gt;</span> https://githu… 2021-09-20       (1 / G… Anthocya…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> vegetation         <span style="color: #949494;">&lt;chr [3]&gt;</span> https://githu… 2022-04-08       N * ((… Anthocya…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> vegetation         <span style="color: #949494;">&lt;chr [4]&gt;</span> https://githu… 2021-05-11       (N - (… Atmosphe…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: platforms &lt;list&gt;, reference &lt;chr&gt;, short_name &lt;chr&gt;</span></span></span></code></pre></div>
<p>This function attempts to grab the newest version of the spectral
indices JSON file from the ASI repo, and then stores that data in a
cache folder on your computer. If the downloading fails, the package
will fall back (with a warning) to use your possibly outdated cache
instead; if you don’t have a cache and can’t download the files, the
package will instead (with a different warning) resort to using a
packaged version of the indices file. This ensures that you’re always
getting the latest and greatest version of the ASI list possible, but
that the package can still be used without an internet connection.</p>
<p>There are also functions in rsi to sort through the ASI list of
indices. For instance, the <code><a href="../reference/filters.html">filter_platforms()</a></code> function can
be used to, well, filter the list to only indices that can be calculated
from a given platform. For instance, to filter to only indices that can
be calculated using data from Landsat’s Operational Land Imager:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/filters.html">filter_platforms</a></span><span class="op">(</span>platforms <span class="op">=</span> <span class="st">"Landsat-OLI"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">#&gt;   application_domain bands     contributor    date_of_addition formula long_name</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> vegetation         <span style="color: #949494;">&lt;chr [2]&gt;</span> https://githu… 2021-11-17       (N - 0… Aerosol …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> vegetation         <span style="color: #949494;">&lt;chr [2]&gt;</span> https://githu… 2021-11-17       (N - 0… Aerosol …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> water              <span style="color: #949494;">&lt;chr [6]&gt;</span> https://githu… 2022-09-22       (B + G… Augmente…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> vegetation         <span style="color: #949494;">&lt;chr [4]&gt;</span> https://githu… 2021-05-11       (N - (… Atmosphe…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> vegetation         <span style="color: #949494;">&lt;chr [4]&gt;</span> https://githu… 2021-05-14       sla * … Adjusted…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> vegetation         <span style="color: #949494;">&lt;chr [2]&gt;</span> https://githu… 2022-04-08       (N * (… Advanced…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: platforms &lt;list&gt;, reference &lt;chr&gt;, short_name &lt;chr&gt;</span></span></span></code></pre></div>
<p>There’s an equivalent function to filter indices based upon the bands
that require. For instance, we can filter the list to only indices that
use the red and blue band of images:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/filters.html">filter_bands</a></span><span class="op">(</span>bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 9</span></span></span>
<span><span class="co">#&gt;   application_domain bands     contributor    date_of_addition formula long_name</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> vegetation         <span style="color: #949494;">&lt;chr [2]&gt;</span> https://githu… 2022-04-08       (R - B… Kawashim…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> vegetation         <span style="color: #949494;">&lt;chr [2]&gt;</span> https://githu… 2022-04-08       (R^2.0… Modified…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: platforms &lt;list&gt;, reference &lt;chr&gt;, short_name &lt;chr&gt;</span></span></span></code></pre></div>
<p>Arguments to these functions let you control whether you’re looking
for indices that match <em>all</em> platforms and bands you’ve
specified, or <em>any</em> of them.</p>
<p>But rsi doesn’t simply make these formulas available in R, it also
helps you compute these indices from imagery, via the
<code><a href="../reference/calculate_indices.html">calculate_indices()</a></code> function. This function takes your
imagery and a subset of <code><a href="../reference/spectral_indices.html">spectral_indices()</a></code> as arguments,
and creates a raster containing all of those indices as an output. We
can use <code><a href="../reference/filters.html">filter_bands()</a></code> to quickly get a list of the indices
we can compute from our Landsat imagery, and then
<code><a href="../reference/calculate_indices.html">calculate_indices()</a></code> to compute all 128 of those indices
from our images:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">our_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_indices.html">calculate_indices</a></span><span class="op">(</span></span>
<span>  <span class="va">our_imagery</span>,</span>
<span>  <span class="fu"><a href="../reference/filters.html">filter_bands</a></span><span class="op">(</span>bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">our_imagery</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="st">"our_indices.tif"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in x@cpp$writeStop(): GDAL Message 1: our_indices.tif: Metadata</span></span>
<span><span class="co">#&gt; exceeding 32000 bytes cannot be written into GeoTIFF. Transferred to PAM</span></span>
<span><span class="co">#&gt; instead.</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">our_indices</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="rsi_files/figure-html/unnamed-chunk-9-1.png" width="768"></p>
<p>Note that <code><a href="../reference/calculate_indices.html">calculate_indices()</a></code> is evaluating the formulas
in the <code>formula</code> column of the spectral indices data frame as
if they were code. These formulas are evaluated inside of a very limited
environment, which doesn’t have access to the global environment or most
R fixtures, which does <em>reduce</em> the amount of harm malicious code
could do:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evil_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spectral_indices.html">spectral_indices</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">evil_index</span><span class="op">$</span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="st">"base::system('echo OHNO')"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/calculate_indices.html">calculate_indices</a></span><span class="op">(</span></span>
<span>    <span class="va">our_imagery</span>,</span>
<span>    <span class="va">evil_index</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in base::system : could not find function "::"</span></span></code></pre></div>
<p>But it’s worth scanning your formulas before running
<code><a href="../reference/calculate_indices.html">calculate_indices()</a></code>, just to make sure you aren’t going to
be accidentally running something surprising!</p>
<p>Last but not least, rsi also provides a way to combine disparate data
sets covering the same geographic region into a single VRT, quickly
creating a file that you can treat as a single raster without taking up
much additional storage space. This is a great way to create predictor
bricks from your indices and downloaded data which you can then use for
model fitting and prediction:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stack_rasters.html">stack_rasters</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">our_imagery</span>, <span class="va">our_dem</span>, <span class="va">our_indices</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".vrt"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">combined_layers</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="rsi_files/figure-html/unnamed-chunk-11-1.png" width="768"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.mm218.dev/" class="external-link">Michael Mahoney</a>, <a href="https://permianglobal.com/" class="external-link"><img src="reference/figures/permian-logo.svg" alt="Permian Global" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
