<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate indices from the bands of a raster — calculate_indices • rsi</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Libre_Franklin-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate indices from the bands of a raster — calculate_indices"><meta name="description" content="This function computes any number of indices from an input raster via
terra::predict(). By default, this function is designed to work with
subsets of spectral_indices(), but it will work with any data frame with a
formula, bands, and short_name column."><meta property="og:description" content="This function computes any number of indices from an input raster via
terra::predict(). By default, this function is designed to work with
subsets of spectral_indices(), but it will work with any data frame with a
formula, bands, and short_name column."><meta property="og:image" content="https://permian-global-research.github.io/rsi/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rsi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/rsi.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Downloading-data-from-STAC-APIs-using-rsi.html">Downloading data from STAC APIs using rsi</a></li>
    <li><a class="dropdown-item" href="../articles/How-can-I-.html">How can I...?</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Permian-Global-Research/rsi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate indices from the bands of a raster</h1>
      <small class="dont-index">Source: <a href="https://github.com/Permian-Global-Research/rsi/blob/main/R/calculate_indices.R" class="external-link"><code>R/calculate_indices.R</code></a></small>
      <div class="d-none name"><code>calculate_indices.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function computes any number of indices from an input raster via
<code><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">terra::predict()</a></code>. By default, this function is designed to work with
subsets of <code><a href="spectral_indices.html">spectral_indices()</a></code>, but it will work with any data frame with a
<code>formula</code>, <code>bands</code>, and <code>short_name</code> column.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calculate_indices</span><span class="op">(</span></span>
<span>  <span class="va">raster</span>,</span>
<span>  <span class="va">indices</span>,</span>
<span>  <span class="va">output_filename</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  wopt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  extra_objects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  names_suffix <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-raster">raster<a class="anchor" aria-label="anchor" href="#arg-raster"></a></dt>
<dd><p>The raster (either as a SpatRaster or object readable by
<code><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">terra::rast()</a></code>) to compute indices from.</p></dd>


<dt id="arg-indices">indices<a class="anchor" aria-label="anchor" href="#arg-indices"></a></dt>
<dd><p>A data frame of indices to compute. The intent is for this
function to work with subsets of <a href="spectral_indices.html">spectral_indices</a>, but any data frame with
columns <code>formula</code> (containing a string representation of the equation used
to calculate the index), <code>bands</code> (a list column containing character vectors
of the necessary bands) and <code>short_name</code> (which will be used as the band
name) will work.</p></dd>


<dt id="arg-output-filename">output_filename<a class="anchor" aria-label="anchor" href="#arg-output-filename"></a></dt>
<dd><p>The filename to write the computed metrics to.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>These dots are for future extensions and must be empty.</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>positive integer. If <code>cores &gt; 1</code>, a 'parallel' package cluster with that many cores is created and used</p></dd>


<dt id="arg-wopt">wopt<a class="anchor" aria-label="anchor" href="#arg-wopt"></a></dt>
<dd><p>list with named options for writing files as in <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></code></p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>logical. If <code>TRUE</code>, <code>filename</code> is overwritten</p></dd>


<dt id="arg-extra-objects">extra_objects<a class="anchor" aria-label="anchor" href="#arg-extra-objects"></a></dt>
<dd><p>A named list of additional objects to pass to the
minimal environment that formulas are executed in. For instance, if you
need to use the <code>pmax</code> function in order to calculate an index, you can
make it available in the environment by setting
<code>extra_objects = list("pmax" = pmax)</code>. Providing extra functionality is
inherently less safe than the default minimal environment, and as such always
emits a warning, which you can suppress with <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings()</a></code>.</p></dd>


<dt id="arg-names-suffix">names_suffix<a class="anchor" aria-label="anchor" href="#arg-names-suffix"></a></dt>
<dd><p>If not <code>NULL</code>, will be used (with <code><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste()</a></code>) to add a
suffix to each of the band names returned.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>output_filename</code>, unchanged.</p>
    </div>
    <div class="section level2">
    <h2 id="security">Security<a class="anchor" aria-label="anchor" href="#security"></a></h2>


<p>Note that this function is running code from the <code>formula</code> column of the
spectral indices data frame, which is derived from a JSON file downloaded off
the internet. It's not impossible that an attacker could take advantage of
this to run arbitrary code on your computer. To mitigate this, indices are
calculated in a minimal environment that contains very few functions or
symbols (preventing an attacker from accessing, for example, <code><a href="https://rdrr.io/r/base/system.html" class="external-link">system()</a></code>).</p>
<p>Still, it's good practice to inspect your <code>formula</code> column to make sure
there's nothing nasty hiding in any of the formulas you're going to run.
Additionally, consider using pre-saved indices tables or
<code>spectral_indices(download_indices = FALSE)</code> if using this in an unsupervised
workload.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">our_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"rasters/example_sentinel1.tif"</span>, package <span class="op">=</span> <span class="st">"rsi"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">calculate_indices</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">our_raster</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="filters.html">filter_bands</a></span><span class="op">(</span>bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">our_raster</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  names_suffix <span class="op">=</span> <span class="st">"sentinel1"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No cache file present and `download_indices` set to `FALSE`.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">ℹ</span> Returning (likely outdated) package data instead.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/tmp/Rtmp8zQvAm/file1b0c1bcae3c6.tif"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Formulas aren't able to access most R functions or operators,</span></span></span>
<span class="r-in"><span><span class="co"># in order to try and keep formulas from doing something bad:</span></span></span>
<span class="r-in"><span><span class="va">example_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="filters.html">filter_platforms</a></span><span class="op">(</span>platforms <span class="op">=</span> <span class="st">"Sentinel-1 (Dual Polarisation VV-VH)"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">example_indices</span><span class="op">$</span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="st">'system("echo something bad")'</span></span></span>
<span class="r-in"><span><span class="co"># So this will error:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">calculate_indices</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"rasters/example_sentinel1.tif"</span>, package <span class="op">=</span> <span class="st">"rsi"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="va">example_indices</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in system("echo something bad") : could not find function "system"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Because of this, formulas which try to use most R functions</span></span></span>
<span class="r-in"><span><span class="co"># will wind up erroring as well:</span></span></span>
<span class="r-in"><span><span class="va">example_indices</span><span class="op">$</span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="st">"pmax(VH, VV)"</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">calculate_indices</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"rasters/example_sentinel1.tif"</span>, package <span class="op">=</span> <span class="st">"rsi"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="va">example_indices</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in pmax(VH, VV) : could not find function "pmax"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To fix this, pass the objects you want to use to `extra_objects`</span></span></span>
<span class="r-in"><span><span class="fu">calculate_indices</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"rasters/example_sentinel1.tif"</span>, package <span class="op">=</span> <span class="st">"rsi"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="va">example_indices</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  extra_objects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pmax <span class="op">=</span> <span class="va">pmax</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span>classes <span class="op">=</span> <span class="st">"rsi_extra_objects"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/tmp/Rtmp8zQvAm/file1b0c2a2beedc.tif"</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.mm218.dev/" class="external-link">Michael Mahoney</a>, <a href="https://permianglobal.com/" class="external-link"><img src="reference/figures/permian-logo.svg" alt="Permian Global" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

